# ab-–∞–Ω–∞–ª–∏–∑-–∫–æ–Ω–≤–µ—Ä—Å–∏–∏

> –£—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è **A/B-–∞–Ω–∞–ª–∏–∑–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏** –Ω–∞ Python: sanity-checks, CR —Å Œî, 95% –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã, p-value, **CUPED**, —Å—Ä–µ–∑—ã –∏ –≥–æ—Ç–æ–≤—ã–π Jupyter-–Ω–æ—É—Ç–±—É–∫.

![Python](https://img.shields.io/badge/Python-3.9%2B-blue)
![Pandas](https://img.shields.io/badge/Pandas-dataframes-lightgrey)
![SciPy](https://img.shields.io/badge/SciPy-stats-green)
![Status](https://img.shields.io/badge/status-learning-brightgreen)

---

## üì¶ –ß—Ç–æ –≤–Ω—É—Ç—Ä–∏

- `ab_test_mock_data.csv` ‚Äî **–º–æ–∫-–¥–∞—Ç–∞—Å–µ—Ç** —Å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–º–∏ –ø–æ–ª—è–º–∏ (–¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏).
- `ab_test_template.ipynb` ‚Äî **Jupyter-–Ω–æ—É—Ç–±—É–∫**: –ø–æ—à–∞–≥–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ –æ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ –≤—ã–≤–æ–¥–∞.
- `README.md` ‚Äî —ç—Ç–æ—Ç —Ñ–∞–π–ª.

---

## üóÇÔ∏è –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö

–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ:
- `user_id` ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ–¥–∏–Ω–∏—Ü–∞ –∞–Ω–∞–ª–∏–∑–∞).  
- `variant` ‚Äî ¬´A¬ª/¬´B¬ª (–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç).  
- `assigned_ts` ‚Äî –≤—Ä–µ–º—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –≤–∞—Ä–∏–∞–Ω—Ç–∞ (datetime).  
- `converted` ‚Äî —Ü–µ–ª–µ–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ (0/1).

–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ (–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã):
- `country`, `device`, `source` ‚Äî —Å—Ä–µ–∑—ã/–ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–ª–∞–Ω—Å–∞.  
- `prior_activity` ‚Äî –ø—Ä–µ–¥—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –∫–æ–≤–∞—Ä–∏–∞—Ç –¥–ª—è **CUPED**.  
- `sessions` ‚Äî –ø—Ä–æ–∫—Å–∏ —ç–∫—Å–ø–æ–∑–∏—Ü–∏–∏.  
- `conversion_ts` ‚Äî –≤—Ä–µ–º—è –∫–æ–Ω–≤–µ—Ä—Å–∏–∏.  
- `revenue` ‚Äî –≤—ã—Ä—É—á–∫–∞ (–¥–ª—è –≤—Ç–æ—Ä–∏—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞).

> ‚ö†Ô∏è –í–∞–∂–Ω–æ: –∫–æ–≤–∞—Ä–∏–∞—Ç—ã –¥–ª—è CUPED —Å—á–∏—Ç–∞—é—Ç—Å—è **–¥–æ** `assigned_ts` (–±–µ–∑ leakage).

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1) –ö–ª–æ–Ω–∏—Ä—É–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <your-repo-url>
cd <repo>

# 2) (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
python -m venv .venv && source .venv/bin/activate  # Windows: .venv\Scripts\activate
pip install -r requirements.txt  # —Å–º. –ø—Ä–∏–º–µ—Ä –Ω–∏–∂–µ

# 3) Sanity-check –Ω–∞ —Å–≤–æ—ë–º CSV
python ab_sanity_check.py --csv your_ab_export.csv --out_md sanity_report.md

# 4) –û—Ç–∫—Ä–æ–π –Ω–æ—É—Ç–±—É–∫ –∏ –∏–¥–∏ –ø–æ —à–∞–≥–∞–º
jupyter lab   # –∏–ª–∏ jupyter notebook / VS Code / Colab
```

–ï—Å–ª–∏ –Ω–µ—Ç `requirements.txt`, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä:
```bash
pip install pandas numpy scipy statsmodels matplotlib
```

---

## üìí –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –Ω–æ—É—Ç–±—É–∫–µ (`ab_test_template.ipynb`)

1. **–ò–º–ø–æ—Ä—Ç –∏ `CSV_PATH`** ‚Äî —É–∫–∞–∂–∏ –ø—É—Ç—å –∫ —Å–≤–æ–µ–π –≤—ã–≥—Ä—É–∑–∫–µ.  
2. **Sanity-checks** ‚Äî —Å–ø–ª–∏—Ç A/B, —É—Ç–µ—á–∫–∏ (multi-assign), –≤—Ä–µ–º–µ–Ω–Ω–æ–π –±–∞–ª–∞–Ω—Å (KS), –±–∞–ª–∞–Ω—Å –∫–æ–≤–∞—Ä–∏–∞—Ç (œá¬≤/Welch t).  
3. **–û—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç** ‚Äî CR –ø–æ A/B, –∞–±—Å–æ–ª—é—Ç–Ω–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ (B-A), 95% CI (Wald), z-—Ç–µ—Å—Ç –¥–≤—É—Ö –¥–æ–ª–µ–π, p-value, –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π uplift %.  
4. **CUPED** ‚Äî –≤–∞—Ä–∏–∞–Ω—Å-—Ä–µ–¥—É–∫—Ü–∏—è —Å `prior_activity` (—É–∂–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ).  
5. **–°–µ–≥–º–µ–Ω—Ç—ã** ‚Äî –ø—Ä–∏–º–µ—Ä `device √ó source` (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏).  
6. **–í—ã—Ä—É—á–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)** ‚Äî Welch t-test, –º–µ–¥–∏–∞–Ω—ã, –±—ã—Å—Ç—Ä—ã–µ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã.  
7. **–ê–≤—Ç–æ–≤—ã–≤–æ–¥** ‚Äî –≥–æ—Ç–æ–≤—ã–π –±–∏–∑–Ω–µ—Å-—Ç–µ–∫—Å—Ç –¥–ª—è one-pager.

---

## üß∞ CLI-—Å–∫—Ä–∏–ø—Ç—ã

### 1) Sanity-–ø—Ä–æ–≤–µ—Ä–∫–∞ + Markdown-–æ—Ç—á—ë—Ç
```bash
python ab_sanity_check.py --csv your_ab_export.csv --out_md sanity_report.md
```
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:
- –°–ø–ª–∏—Ç A/B –∏ –¥–Ω–µ–≤–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π.  
- –ú—É–ª—å—Ç–∏-–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∏ –¥—É–±–ª–∏ –ø–æ `user_id`.  
- KS-—Ç–µ—Å—Ç –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π (`assigned_ts`).  
- –ë–∞–ª–∞–Ω—Å –∫–æ–≤–∞—Ä–∏–∞—Ç: œá¬≤ (–∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ), Welch t (—á–∏—Å–ª–æ–≤—ã–µ).

### 2) –û—Å–Ω–æ–≤–Ω–æ–π –∞–Ω–∞–ª–∏–∑ (–∫–æ–Ω–≤–µ—Ä—Å–∏—è / –≤—ã—Ä—É—á–∫–∞)
```bash
# –ö–æ–Ω–≤–µ—Ä—Å–∏—è
python ab_analysis_template.py --csv your_ab_export.csv --metric conversion --alpha 0.05

# –í—ã—Ä—É—á–∫–∞
python ab_analysis_template.py --csv your_ab_export.csv --metric revenue
```
–í—ã–≤–æ–¥–∏—Ç:
- –¢–∞–±–ª–∏—Ü—É A vs B: `conversions`, `visitors`, `CR`.  
- Œî (B‚àíA), 95% CI, –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç, z-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ p-value.  
- CUPED-–æ—Ü–µ–Ω–∫—É (–µ—Å–ª–∏ –µ—Å—Ç—å `prior_activity`).  
- –ü—Ä–∏–º–µ—Ä —Å–µ–≥–º–µ–Ω—Ç–æ–≤.

---

## üß™ –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è (–∫—Ä–∞—Ç–∫–æ)

- **–ï–¥–∏–Ω–∏—Ü–∞ –∞–Ω–∞–ª–∏–∑–∞:** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (`user_id`).  
- **–ú–µ—Ç—Ä–∏–∫–∞:** `converted` (0/1), CR = `sum / count`.  
- **–¢–µ—Å—Ç:** –¥–≤—É—Ö—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π **z-—Ç–µ—Å—Ç –¥–≤—É—Ö –¥–æ–ª–µ–π**; CI ‚Äî Wald (–¥–ª—è –ø—Ä–æ–¥-–∫–µ–π—Å–æ–≤ –º–æ–∂–Ω–æ Wilson/Newcombe).  
- **CUPED:** \( y_{adj}=y-\theta(x-\bar{x}) \) ‚Äî —Å–Ω–∏–∂–∞–µ—Ç –¥–∏—Å–ø–µ—Ä—Å–∏—é –ø—Ä–∏ —Å–∏–ª—å–Ω–æ–º –ø—Ä–µ–¥–∏–∫—Ç–æ—Ä–µ `x`.  
- **Guardrails:** –∑–∞—Ä–∞–Ω–µ–µ —Ñ–∏–∫—Å–∏—Ä—É–π –∫—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ —Å–ª–µ–¥–∏ –∑–∞ –Ω–µ–≥–∞—Ç–∏–≤–æ–º –ø–æ –∫–ª—é—á–µ–≤—ã–º –º–µ—Ç—Ä–∏–∫–∞–º.  
- **–°–µ–≥–º–µ–Ω—Ç—ã:** —Ç–æ–ª—å–∫–æ –∫–∞–∫ –¥–æ–ø.–∞–Ω–∞–ª–∏–∑; —É—á–∏—Ç—ã–≤–∞–π –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, BH/FDR).

---

## üß± –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ ab_test_mock_data.csv
‚îú‚îÄ‚îÄ ab_test_template.ipynb
‚îú‚îÄ‚îÄ ab_analysis_template.py
‚îú‚îÄ‚îÄ ab_sanity_check.py
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ requirements.txt       # (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

---

## üß© –ü—Ä–∏–º–µ—Ä SQL (–∞–≥—Ä–µ–≥–∞—Ü–∏—è —Å—ã—Ä—ã—Ö —Å–æ–±—ã—Ç–∏–π)

```sql
WITH assign AS (
  SELECT user_id,
         MIN(assigned_ts) AS assigned_ts,
         ANY_VALUE(variant) AS variant
  FROM ab_assignments
  GROUP BY 1
),
conv AS (
  SELECT user_id,
         MIN(event_ts) AS conversion_ts,
         1 AS converted
  FROM events
  WHERE event_name = 'signup'
  GROUP BY 1
),
attrs AS (
  SELECT user_id, country, device, source, prior_activity, sessions
  FROM user_attrs_snapshot
)
SELECT a.user_id, a.assigned_ts, a.variant,
       at.country, at.device, at.source, at.prior_activity, at.sessions,
       COALESCE(c.converted, 0) AS converted,
       c.conversion_ts
FROM assign a
LEFT JOIN conv c USING (user_id)
LEFT JOIN attrs at USING (user_id);
```

---

## üìù One-pager (—à–∞–±–ª–æ–Ω –≤—ã–≤–æ–¥–∞)

- **–¶–µ–ª—å –∏ –≥–∏–ø–æ—Ç–µ–∑–∞** (–º–µ—Ç—Ä–∏–∫–∞, MDE, –∫—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏).  
- **–î–∏–∑–∞–π–Ω** (—Ä–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏—è, –æ–∫–Ω–æ, —Ñ–∏–ª—å—Ç—Ä—ã).  
- **–ò—Ç–æ–≥:** A vs B ‚Äî CR, Œî (–ø.–ø.), 95% CI, p-value, –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç.  
- **–ö–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö:** —Å–ø–ª–∏—Ç/—É—Ç–µ—á–∫–∏/–±–∞–ª–∞–Ω—Å.  
- **–°–µ–≥–º–µ–Ω—Ç—ã/guardrails:** –∫–æ—Ä–æ—Ç–∫–æ, –±–µ–∑ ¬´p-—Ö–∞–Ω—Ç–∏–Ω–≥–∞¬ª.  
- **–†–µ—à–µ–Ω–∏–µ –∏ —Ä–∏—Å–∫–∏** + **next steps**.

---

## ü§ù Contributing

–ò–¥–µ–∏ welcome: –±—É—Ç—Å—Ç—Ä—ç–ø-CI, BH/FDR, –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è (ANCOVA), —ç–∫—Å–ø–æ—Ä—Ç –æ—Ç—á—ë—Ç–∞ –≤ PDF/HTML.

---

## üìÑ License

MIT 

---

### `requirements.txt` 

```
pandas>=1.5
numpy>=1.23
scipy>=1.10
statsmodels>=0.14
matplotlib>=3.7
```
